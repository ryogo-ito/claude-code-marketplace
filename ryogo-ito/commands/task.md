---
name: task
description: 要件からPR作成までの一連の実装プロセスを実行するスキル。影響範囲調査、実装計画、エッジケース検討、実装、コミット分割、PR作成を段階的に行う。「/task」で起動し、タスクの実装を依頼されたときに使用する。
---

# Task

要件を受け取り、調査・計画・実装・PR作成までを一貫して行うワークフロースキル。

## 起動条件

- ユーザーが `/task` を実行したとき
- 新機能の実装やバグ修正などのタスクを依頼されたとき

## ワークフロー

### Phase 1: 要件の収集

1. ユーザーから以下を収集する:
   - **要件**: 口頭説明またはドキュメントリンク
   - **ベースブランチ**: どのブランチから切るか（例: `develop`, `main`）

2. ドキュメントリンクが渡された場合は以下で内容を読み込む:
   - **MCP**: 認証が必要なサービス（Google Docs, Confluence, Jira, GitHub など）
   - **WebFetch**: 公開されているWebページ
   - **Read**: ローカルファイル

3. 要件を自分の言葉で要約し、認識が正しいか確認を取る

### Phase 2: 影響範囲の調査

1. コードベースを探索し、変更が必要なファイル・関数を特定する
2. 関連するコンポーネント、依存関係、テストファイルをリストアップする
3. 他の機能への影響がないか確認する

### Phase 3: 実装計画の策定

1. 具体的な実装手順を洗い出す
2. 変更が必要なファイルと変更内容を明確にする
3. 既存のコードパターンやアーキテクチャに従う方針を決める

### Phase 4: エッジケース・実装仕様の検討

1. 考慮すべきエッジケースを洗い出す
2. エラーハンドリングの方針を決める
3. 実装仕様に矛盾や問題がないか検証する
4. パフォーマンスやセキュリティの懸念点があれば洗い出す

### Phase 5: 計画の提出と承認

以下の形式で計画をまとめ、ユーザーに提出する:

```
## 実装計画

### 要件サマリ
[要件の要約]

### 影響範囲
- [変更対象ファイル1]: [変更内容]
- [変更対象ファイル2]: [変更内容]

### 実装手順
1. [手順1]
2. [手順2]
...

### エッジケース・考慮事項
- [考慮事項1]
- [考慮事項2]

### コミット分割案
1. [コミット1]: [内容]
2. [コミット2]: [内容]
```

**ユーザーの承認を得てから次のPhaseに進む**

### Phase 6: 実装

1. ベースブランチから新しいブランチを作成する
   - ブランチ名: `feature/xxx`, `fix/xxx`, `refactor/xxx` など適切なプレフィックスを使用
2. 計画に従ってコードを実装する
3. 型チェック・リントを実行し、エラーがないことを確認する

### Phase 7: コミットの分割と作成

**Conventional Commits 形式**でコミットメッセージを作成する:

```
<type>[optional scope]: <description>

[optional body]

Co-Authored-By: Claude <model>
```

**type の種類**:
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響しない変更（空白、フォーマット等）
- `refactor`: バグ修正でも機能追加でもないコード変更
- `perf`: パフォーマンス改善
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやツールの変更

**コミット分割の原則**:
- 論理的に意味のある単位で分割する
- 各コミットは単独でビルド・テストが通る状態を維持する
- 関連する変更は同じコミットにまとめる

### Phase 8: PR作成

1. リモートにプッシュする
2. PRテンプレートの確認:
   - `.github/PULL_REQUEST_TEMPLATE.md` が存在すればそれに従う
   - 存在しない場合は以下の形式を使用:

```markdown
## ゴール
[このPRで達成すること]

## 詳細
[実装の詳細説明]

## 他の開発者への影響
[他の開発者が知っておくべき変更点、破壊的変更など]

## 補足
[レビュアーへの補足情報、スクリーンショットなど]

## 背景
[なぜこの変更が必要か（あれば）]
```

3. `gh pr create` でPRを作成し、URLをユーザーに共有する

## 専門エージェントの活用

各Phaseで専門のサブエージェント（Taskツール）が利用可能な場合は積極的に活用する:

| Phase | 推奨エージェント | 用途 |
|-------|------------------|------|
| Phase 2: 影響範囲調査 | `Explore` | コードベース探索、ファイル検索 |
| Phase 3: 実装計画 | `Plan` | アーキテクチャ設計、実装戦略 |
| Phase 4: エッジケース検討 | `cook:roles:analyzer` | 根本原因分析、問題特定 |
| Phase 4: セキュリティ懸念 | `cook:roles:security` | 脆弱性検出、OWASP対応 |
| Phase 6: 実装（フロントエンド） | `cook:roles:frontend` | UI/UX、React/Vue最適化 |
| Phase 6: 実装（バックエンド） | `cook:roles:backend` | API設計、サーバーレス |
| Phase 8: PR作成前 | `cook:roles:reviewer` | コードレビュー、品質評価 |

**使用判断**: タスクの複雑さや専門性に応じて判断する。単純なタスクでは不要。

## 注意事項

- 各Phaseで不明点があれば、先に進む前にユーザーに確認する
- Phase 5の承認なしに実装を開始しない
- 既存のコードスタイル・パターンに従う
- pre-commit hookが設定されている場合は、hookの実行を待つ
- 専門エージェントが利用可能な場合は積極的に活用する
